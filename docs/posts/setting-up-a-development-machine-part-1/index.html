<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Kalkayan Engineering</title><link rel=stylesheet href=https://engineering.kalkayan.io/scss/main.min.9db8651f3f7598964314c80e4e9cae9a65a2025ca2634d756b2a8054a276b2f6.css><script src=https://engineering.kalkayan.io/js/bootstrap.min.js></script></head><body id=top><nav class="navbar navbar-expand-lg navbar-light fixed-top pt-3 pb-3"><div class=container><a class="nav-link pl-0 text-muted" href=#>Engineering</a><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class=navbar-nav style=margin-left:auto><li class="nav-item active"><a class=nav-link href=#>Home</a></li><li class=nav-item><a class=nav-link href=https://github.com/kalkayan/dotfiles>github</a></li></ul></div></div></nav><main class=main><article><div class=banner><div class=container><div class=col-md-10><h1 class=title style="font-size:calc(80px - 13px)">Setting up a Development Machine [Part 1]: Automated Installation</h1></div><p>By Manish Sahani on Monday, 15 July 2019</p></div></div><div class=post><div class=container><div class=description>Many nights of potential productive work programmers have lost by procrastinating on properly setting up a new machine's development environment. This is the first article of the series which discusses some elegant ways to set up your new device with one single command.</div><div class=content><p>Setting up a new development machine is a long and painful process; nobody ever remembers what they have installed in their previous device. This guide is here to help you automate everything in your development setup and lets you enjoy the exciting feeling of getting a new machine.</p><p>The guide has three parts: first is automating the installation of binaries and applications, then configuring code applications (vim, tmux, etc.) and customizing the operating system with dotfiles, and finally how to store and share them. I&rsquo;ll set up a MacBook Pro in all the articles, but you can always expand it to other surfaces like Linux.</p><h1 id=getting-started>Getting Started<a hidden class=anchor aria-hidden=true href=#getting-started>#</a></h1><p>When you have a new MacBook, what is the first thing you do? (After posting its picture on LinkedIn): Download necessary apps like Spotify, Slack, VS Code, etc., right?. Visiting tens of websites and downloading dmgs was such a long, painful and tedious process until brew casks came into the picture. This feature of Homebrew gives us an excellent starting point for automating the setup process.</p><p>We can have a small bash script and call Homebrew from there. Building on this idea, in this series, we&rsquo;ll write a script such that it can set up your brand new machine with just one command of the following structure.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -fsSL https://example.com/setup.sh | bash
</code></pre></div><p>Let&rsquo;s create this <code>setup</code> script in the $HOME directory, which will automate our future set-up process.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>touch $HOME/setup
</code></pre></div><h1 id=neccessay-tools-and-a-package-manager>Neccessay tools and a Package Manager<a hidden class=anchor aria-hidden=true href=#neccessay-tools-and-a-package-manager>#</a></h1><p>We need to install XCode command-line tools, which install all the common and necessary things like macOS SDK, headers, build tools, compilers, interpreters, etc. Add the following in the previously created script:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/usr/bin/env bash
</span><span style=color:#75715e></span>
<span style=color:#75715e># Install xcode command line tool if not already installed</span>
<span style=color:#66d9ef>if</span> ! xcode-select -p 1&gt;/dev/null; <span style=color:#66d9ef>then</span>
    xcode-select --install
<span style=color:#66d9ef>fi</span>
</code></pre></div><p>First, the above lines check for xcode-select&rsquo;s path (<code>-p</code> is for printing the path of the active developer directory), and if not present, it installs using the <code>--install</code> flag.</p><p>Then we install a system package manager &ndash; Homebrew, using the similar if-then structure.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/usr/bin/env bash
</span><span style=color:#75715e></span>
<span style=color:#75715e># Install xcode command line tool if ....</span>

<span style=color:#75715e># Install brew.sh (system package manager) if already not installed</span>
<span style=color:#66d9ef>if</span> ! brew -h 1&gt;/dev/null; <span style=color:#66d9ef>then</span>
    echo /bin/bash -c <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
<span style=color:#66d9ef>fi</span>

<span style=color:#75715e># Update brew to latest available version</span>
brew update
</code></pre></div><p>After installing brew, we run <code>brew update</code> to ensure we have the latest version installed.</p><h1 id=installing-applications-and-libraries>Installing Applications and libraries<a hidden class=anchor aria-hidden=true href=#installing-applications-and-libraries>#</a></h1><p>In this section, We deal with installing applications and libraries, and I&rsquo;ll show you one of the coolest ways to manage and automate this process with just a few bash lines.</p><p>It is hard to remember what applications and libraries we had previously installed. Homebrew has <code>homebrew-bundle</code> to take care of this by dumping all the installed taps, bins, and casks in a <code>Brewfile</code> which can install all these in the future. The problem here is that <code>Brewfile</code> doesn&rsquo;t store versions of the bins or casks. It installs the latest version of the binaries, which can sometimes cause you trouble. For example, if you have PHP installed &ndash; or in general software that doesn&rsquo;t have backward compatibility.</p><p>To solve this problem of versioning, let us start from the most straightforward thing and create a list of binaries and casks that we need (name it <code>bins.txt</code> and <code>casks.txt</code>).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>touch $HOME/.config/kalkayan/bins.txt $HOME/.config/kalkayan/casks.txt
</code></pre></div><p>We list down all the brew formulas for binaries and casks with their versions that we want to have in our system in their specific file. for example &ndash;</p><pre><code>hades in ~ $ cat $HOME/.config/kalkayan/bins.txt
coreutils
llvm
go
php@7.4
nvm
...
</code></pre><p>To automate these bins and casks' installation, we need to import these lists in our <code>setup</code> script. <code>mapfile</code> creates an array from the file, and now we have our list store in collections named <code>bins</code> and <code>casks</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/usr/bin/env bash
</span><span style=color:#75715e></span>
<span style=color:#75715e># Install xcode command line tool if....</span>

<span style=color:#75715e># Install brew.sh (system package manager)....</span>

<span style=color:#75715e># List of binaries that needs be installed</span>
mapfile -t bins &lt;  &lt;<span style=color:#f92672>(</span>cat $HOME/.config/kalkayan/bins.txt<span style=color:#f92672>)</span>

<span style=color:#75715e># List of casks that needs be installed</span>
mapfile -t casks &lt; &lt;<span style=color:#f92672>(</span>cat $HOME/.config/kalkayan/casks.txt<span style=color:#f92672>)</span>
</code></pre></div><p>Now we iterate over these arrays and check for the library if already installed. If not, we install it using brew. In the following code, first, we split the name at <code>@</code> and take the first (example &ndash; <code>php</code> in <code>php@7.4</code> )</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># List of casks ....</span>

<span style=color:#75715e># Install binaries using Homebrew, iterate over bins array and install.</span>
<span style=color:#66d9ef>for</span> binary in <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>bins[@]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>do</span>
    <span style=color:#75715e># split the brew formula into binary name and version of installation and</span>
    <span style=color:#75715e># get the name of the binary (ex- php in php@7.4)</span>
    b<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>echo $binary | cut -d <span style=color:#ae81ff>\@</span> -f 1<span style=color:#e6db74>`</span>
    <span style=color:#75715e># check if the binary is already present, otherwise install</span>
    <span style=color:#66d9ef>if</span> ! brew list --formula | grep <span style=color:#e6db74>&#34;</span>$b<span style=color:#e6db74>&#34;</span> 1&gt;/dev/null; <span style=color:#66d9ef>then</span>
        brew install <span style=color:#e6db74>&#34;</span>$binary<span style=color:#e6db74>&#34;</span>
    <span style=color:#66d9ef>fi</span>
<span style=color:#66d9ef>done</span>
</code></pre></div><p>Similarly, we write a loop for casks but without worrying about the versions (can be extended if required)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># Install binaries using Homebrew, ....</span>

<span style=color:#75715e># Install casks using Homebrew, iterate over casks array and install.</span>
<span style=color:#66d9ef>for</span> c in <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>casks[@]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>do</span>
    <span style=color:#75715e># first, check if the cask is present or not, if not install</span>
    <span style=color:#66d9ef>if</span> ! brew list --cask | grep <span style=color:#e6db74>&#34;</span>$c<span style=color:#e6db74>&#34;</span> 1&gt;/dev/null; <span style=color:#66d9ef>then</span>
        brew casks install <span style=color:#e6db74>&#34;</span>$c<span style=color:#e6db74>&#34;</span>
    <span style=color:#66d9ef>fi</span>
<span style=color:#66d9ef>done</span>
</code></pre></div><p>In the second part of this series, we&rsquo;ll create a bash function to update our bins.txt and casks.txt when a bin/cask is installed or removed.</p></div></div></div></article><footer class=footer><span>&copy; 2021 <a href=https://engineering.kalkayan.io>Kalkayan Engineering</a></span>
<span>&#183;</span><br><span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>Kalkayan.eng</a></span></footer><script>let scrollpos=window.scrollY;const header=document.querySelector("nav"),add_class_on_scroll=a=>header.classList.add(a),remove_class_on_scroll=a=>header.classList.remove(a);window.addEventListener('scroll',function(){scrollpos=window.scrollY,scrollpos>='400'?(add_class_on_scroll("bg-white"),add_class_on_scroll("shadow-sm")):(remove_class_on_scroll("bg-white"),remove_class_on_scroll("shadow-sm"))})</script></main></body></html>